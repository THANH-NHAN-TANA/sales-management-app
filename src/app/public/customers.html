<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kh√°ch h√†ng - Sales Management System</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="alternate icon" href="/favicon.ico" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      /* S·ª≠ d·ª•ng CSS t∆∞∆°ng t·ª± products.html ƒë·ªÉ ƒë·∫£m b·∫£o giao di·ªán ƒë·ªìng nh·∫•t */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo i {
        background: rgba(255, 255, 255, 0.2);
        padding: 10px;
        border-radius: 10px;
        font-size: 22px;
      }

      .nav-menu {
        display: flex;
        gap: 25px;
        align-items: center;
      }

      .nav-item {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 10px 15px;
        border-radius: 8px;
        transition: all 0.3s ease;
        text-decoration: none;
        color: white;
        font-weight: 500;
        position: relative;
      }

      .nav-item:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-1px);
      }

      .nav-item.active {
        background: rgba(255, 255, 255, 0.25);
        font-weight: 600;
      }

      .nav-item.active::after {
        content: "";
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
      }

      .user-name {
        font-weight: 600;
        font-size: 15px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #fff, #f0f0f0);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #667eea;
        font-size: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .user-avatar:hover {
        transform: scale(1.05);
        border-color: rgba(255, 255, 255, 0.5);
      }

      .settings-btn {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
        padding: 10px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .settings-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: rotate(90deg);
      }

      .dropdown-menu {
        position: absolute;
        top: 120%;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        min-width: 220px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-15px);
        transition: all 0.4s ease;
        z-index: 1000;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      .dropdown-menu.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px 20px;
        color: #333;
        text-decoration: none;
        transition: all 0.2s ease;
        border: none;
        background: none;
        width: 100%;
        text-align: left;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      .dropdown-item:hover {
        background: #f8f9fa;
      }

      .dropdown-item:first-child {
        border-bottom: 1px solid #eee;
      }

      .dropdown-item:first-child:hover {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
      }

      .dropdown-item:last-child:hover {
        background: rgba(244, 67, 54, 0.1);
        color: #f44336;
      }

      .dropdown-icon {
        font-size: 16px;
        width: 20px;
        text-align: center;
      }

      .main-content {
        padding: 30px;
        max-width: 1400px;
        margin: 0 auto;
        min-height: calc(100vh - 80px);
      }

      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .page-title {
        font-size: 32px;
        font-weight: 700;
        color: #2c3e50;
      }

      .page-subtitle {
        color: #7f8c8d;
        font-size: 16px;
        margin-top: 5px;
      }

      .add-customer-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .add-customer-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
      }

      .customers-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 6px 30px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
      }

      .section-header {
        padding: 25px 30px;
        border-bottom: 1px solid #eee;
        background: linear-gradient(135deg, #f8f9fa, #ffffff);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .section-title {
        font-size: 20px;
        font-weight: 700;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .search-filters {
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .search-input {
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        width: 250px;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .filter-select {
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .filter-select:focus {
        outline: none;
        border-color: #667eea;
      }

      .customers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        padding: 30px;
      }

      .customer-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        overflow: hidden;
        border: 1px solid #f0f0f0;
      }

      .customer-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .customer-image {
        height: 200px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        color: white;
        position: relative;
      }

      .customer-details {
        padding: 20px;
      }

      .customer-name {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
      }

      .customer-email {
        color: #7f8c8d;
        font-size: 14px;
        margin-bottom: 12px;
      }

      .customer-phone {
        font-size: 16px;
        color: #2c3e50;
        margin-bottom: 12px;
      }

      .customer-actions {
        display: flex;
        gap: 10px;
      }

      .action-btn {
        flex: 1;
        padding: 8px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
      }

      .btn-edit {
        background: #17a2b8;
        color: white;
      }

      .btn-edit:hover {
        background: #138496;
      }

      .btn-delete {
        background: #dc3545;
        color: white;
      }

      .btn-delete:hover {
        background: #c82333;
      }

      .empty-state {
        text-align: center;
        padding: 60px 40px;
        color: #7f8c8d;
      }

      .empty-state i {
        font-size: 64px;
        margin-bottom: 20px;
        color: #bdc3c7;
      }

      .empty-state h3 {
        font-size: 24px;
        margin-bottom: 10px;
        color: #95a5a6;
      }

      .empty-state p {
        font-size: 16px;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 4000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        backdrop-filter: blur(3px);
      }

      .loading-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      .loading-text {
        color: #667eea;
        font-weight: 600;
        font-size: 16px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .notification {
        position: fixed;
        top: 25px;
        right: 25px;
        padding: 18px 24px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        z-index: 3000;
        animation: slideInRight 0.4s ease;
        max-width: 350px;
        font-weight: 500;
      }

      .notification.success {
        background: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
      }

      .notification.error {
        background: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
      }

      .notification.warning {
        background: #fff3cd;
        color: #856404;
        border-left: 4px solid #ffc107;
      }

      .notification.info {
        background: #d1ecf1;
        color: #0c5460;
        border-left: 4px solid #17a2b8;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.4s ease;
        backdrop-filter: blur(5px);
      }

      .modal-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 35px;
        max-width: 500px;
        width: 90%;
        max-height: 85vh;
        overflow-y: auto;
        transform: scale(0.8);
        transition: transform 0.4s ease;
        position: relative;
      }

      .modal-overlay.show .modal-content {
        transform: scale(1);
      }

      .modal-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      .modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
        margin: 0;
      }

      .modal-icon {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .close-modal {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        font-size: 24px;
        color: #999;
        cursor: pointer;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .close-modal:hover {
        background: #f0f0f0;
        color: #666;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        font-weight: 600;
        color: #555;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .form-input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 14px;
        background: #f9f9f9;
        color: #333;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .form-input:focus {
        outline: none;
        border-color: #667eea;
        background: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .modal-buttons {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        margin-top: 30px;
        padding-top: 25px;
        border-top: 1px solid #eee;
      }

      .btn {
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        background: #f5f5f5;
        color: #666;
        border: 1px solid #ddd;
      }

      .btn-secondary:hover {
        background: #e9e9e9;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(220, 53, 69, 0.3);
      }

      .profile-modal .modal-content {
        max-width: 600px;
      }

      .profile-section {
        margin-bottom: 25px;
      }

      .profile-section .section-title {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .password-section {
        border-top: 1px solid #eee;
        padding-top: 25px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 15px;
        font-size: 14px;
        color: #666;
      }

      .checkbox-item input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #667eea;
      }

      .delete-modal .modal-content {
        max-width: 400px;
        text-align: center;
      }

      .delete-icon {
        background: #dc3545;
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin: 0 auto 20px;
      }

      .delete-message {
        font-size: 16px;
        color: #666;
        margin-bottom: 10px;
      }

      .delete-customer-name {
        font-weight: 700;
        color: #2c3e50;
        font-size: 18px;
        margin-bottom: 25px;
      }

      @media (max-width: 768px) {
        .nav-menu {
          display: none;
        }

        .main-content {
          padding: 20px 15px;
        }

        .page-header {
          flex-direction: column;
          gap: 20px;
          align-items: flex-start;
        }

        .search-filters {
          flex-direction: column;
          width: 100%;
        }

        .search-input {
          width: 100%;
        }

        .customers-grid {
          grid-template-columns: 1fr;
          padding: 20px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .modal-content {
          padding: 25px 20px;
          margin: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
      <div class="loading-text">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    </div>

    <header class="header">
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <span>MeTroMini Store</span>
      </div>

      <nav class="nav-menu">
        <a
          href="/dashboard"
          class="nav-item nav-dashboard"
          data-page="dashboard"
        >
          <i class="fas fa-home"></i>
          T·ªïng quan
        </a>
        <a
          href="/products-page"
          class="nav-item nav-products"
          data-page="products"
        >
          <i class="fas fa-box"></i>
          S·∫£n ph·∫©m
        </a>
        <a
          href="/customers-page"
          class="nav-item nav-customers"
          data-page="customers"
        >
          <i class="fas fa-users"></i>
          Kh√°ch h√†ng
        </a>
        <a href="/orders-page" class="nav-item nav-orders" data-page="orders">
          <i class="fas fa-shopping-cart"></i>
          ƒê∆°n h√†ng
        </a>
        <a
          href="/statistics-page"
          class="nav-item nav-statistics"
          data-page="statistics"
        >
          <i class="fas fa-chart-bar"></i>
          Th·ªëng k√™
        </a>
      </nav>

      <div class="user-info">
        <span class="user-name" id="userName">ƒêang t·∫£i...</span>
        <div class="user-avatar" id="userAvatar" title="Th√¥ng tin c√° nh√¢n">
          ?
        </div>
        <button class="settings-btn" id="settingsBtn" title="C√†i ƒë·∫∑t">
          <i class="fas fa-cog"></i>
        </button>
        <div class="dropdown-menu" id="dropdownMenu">
          <button class="dropdown-item" id="profileBtn">
            <i class="fas fa-user dropdown-icon"></i>
            Th√¥ng tin c√° nh√¢n
          </button>
          <button class="dropdown-item" id="logoutBtn">
            <i class="fas fa-sign-out-alt dropdown-icon"></i>
            ƒêƒÉng xu·∫•t
          </button>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="page-header">
        <div>
          <h1 class="page-title">Qu·∫£n l√Ω kh√°ch h√†ng</h1>
          <p class="page-subtitle">
            Qu·∫£n l√Ω danh s√°ch kh√°ch h√†ng trong h·ªá th·ªëng
          </p>
        </div>
        <button class="add-customer-btn" id="addCustomerBtn">
          <i class="fas fa-plus"></i>
          Th√™m kh√°ch h√†ng
        </button>
      </div>

      <div class="customers-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-users"></i>
            Danh s√°ch kh√°ch h√†ng
          </h2>
          <div class="search-filters">
            <input
              type="text"
              class="search-input"
              id="searchInput"
              placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c email..."
              autocomplete="new-text"
              name="search_random"
            />
          </div>
        </div>

        <div class="customers-grid" id="customersGrid">
          <!-- Customers will be loaded here -->
        </div>
      </div>
    </main>

    <!-- Profile Modal -->
    <div class="modal-overlay profile-modal" id="profileModal">
      <div class="modal-content">
        <button class="close-modal" id="closeProfileModalBtn" title="ƒê√≥ng">
          √ó
        </button>

        <div class="modal-header">
          <div class="modal-icon">
            <i class="fas fa-user"></i>
          </div>
          <h2 class="modal-title">Th√¥ng tin c√° nh√¢n</h2>
        </div>

        <div class="profile-section">
          <div class="section-title">
            <i class="fas fa-id-card"></i>
            Th√¥ng tin t√†i kho·∫£n
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
              <input
                type="text"
                class="form-input"
                id="profileUsername"
                readonly
              />
            </div>
            <div class="form-group">
              <label class="form-label">Vai tr√≤</label>
              <input
                type="text"
                class="form-input"
                id="profileUserRole"
                readonly
              />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="profileEmail" readonly />
          </div>

          <div class="form-group">
            <label class="form-label">H·ªç v√† t√™n</label>
            <input type="text" class="form-input" id="profileFullName" />
          </div>
        </div>

        <div class="profile-section password-section">
          <div class="section-title">
            <i class="fas fa-lock"></i>
            ƒê·ªïi m·∫≠t kh·∫©u
          </div>

          <div class="form-group">
            <label class="form-label">M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
            <input
              type="password"
              class="form-input"
              id="profileOldPassword"
              placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">M·∫≠t kh·∫©u m·ªõi</label>
              <input
                type="password"
                class="form-input"
                id="profileNewPassword"
                placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi"
              />
            </div>
            <div class="form-group">
              <label class="form-label">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
              <input
                type="password"
                class="form-input"
                id="profileConfirmPassword"
                placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u"
              />
            </div>
          </div>

          <div class="checkbox-item">
            <input type="checkbox" id="profileShowPassword" />
            <label for="profileShowPassword">Hi·ªÉn th·ªã m·∫≠t kh·∫©u</label>
          </div>
        </div>

        <div class="modal-buttons">
          <button class="btn btn-secondary" id="profileCancelBtn">
            <i class="fas fa-times"></i>
            H·ªßy
          </button>
          <button class="btn btn-primary" id="profileSaveBtn">
            <i class="fas fa-save"></i>
            C·∫≠p nh·∫≠t
          </button>
        </div>
      </div>
    </div>

    <!-- Add/Edit Customer Modal -->
    <div class="modal-overlay" id="customerModal">
      <div class="modal-content">
        <button class="close-modal" id="closeCustomerModal" title="ƒê√≥ng">
          √ó
        </button>

        <div class="modal-header">
          <div class="modal-icon">
            <i class="fas fa-user" id="modalIcon"></i>
          </div>
          <h2 class="modal-title" id="modalTitle">Th√™m kh√°ch h√†ng m·ªõi</h2>
        </div>

        <form id="customerForm">
          <div class="form-group">
            <label class="form-label">H·ªç v√† t√™n *</label>
            <input
              type="text"
              class="form-input"
              id="customerFullName"
              placeholder="Nh·∫≠p h·ªç v√† t√™n"
              required
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-input"
                id="customerEmail"
                placeholder="Nh·∫≠p email (t√πy ch·ªçn)"
              />
            </div>
            <div class="form-group">
              <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
              <input
                type="text"
                class="form-input"
                id="customerPhone"
                placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i (t√πy ch·ªçn)"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">ƒê·ªãa ch·ªâ</label>
            <input
              type="text"
              class="form-input"
              id="customerAddress"
              placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ (t√πy ch·ªçn)"
            />
          </div>

          <div class="form-group">
            <label class="form-label">H√¨nh ·∫£nh h·ªì s∆° (URL)</label>
            <input
              type="url"
              class="form-input"
              id="customerProfilePic"
              placeholder="https://example.com/image.jpg"
            />
          </div>

          <div class="modal-buttons">
            <button
              type="button"
              class="btn btn-secondary"
              id="cancelCustomerBtn"
            >
              <i class="fas fa-times"></i>
              H·ªßy
            </button>
            <button type="submit" class="btn btn-primary" id="saveCustomerBtn">
              <i class="fas fa-save"></i>
              <span id="saveButtonText">Th√™m kh√°ch h√†ng</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay delete-modal" id="deleteModal">
      <div class="modal-content">
        <button class="close-modal" id="closeDeleteModal" title="ƒê√≥ng">
          √ó
        </button>

        <div class="delete-icon">
          <i class="fas fa-trash"></i>
        </div>

        <h2 class="modal-title">X√°c nh·∫≠n x√≥a kh√°ch h√†ng</h2>

        <p class="delete-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng:</p>
        <div class="delete-customer-name" id="deleteCustomerName"></div>

        <p class="delete-message" style="color: #dc3545; font-weight: 600">
          H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!
        </p>

        <div class="modal-buttons">
          <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">
            <i class="fas fa-times"></i>
            H·ªßy
          </button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
            <i class="fas fa-trash"></i>
            X√≥a kh√°ch h√†ng
          </button>
        </div>
      </div>
    </div>

    <script>
      console.log("üöÄ Customers Page Loading...");

      // ===================== GLOBAL VARIABLES =====================
      let currentUser = null;
      let authToken = localStorage.getItem("authToken");
      let customers = [];
      let filteredCustomers = [];
      let editingCustomerId = null;
      let customerToDelete = null;

      // ===================== AUTHENTICATION =====================
      async function checkAuth() {
        if (!authToken) {
          console.log("‚ùå No auth token found");
          redirectToLogin();
          return false;
        }

        try {
          showLoading("ƒêang x√°c th·ª±c...");
          console.log("üîç Verifying authentication token");

          const response = await fetch("/api/auth/verify", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
            credentials: "include",
          });

          if (response.ok) {
            const result = await response.json();
            console.log("üîç Auth response:", result);

            if (result.success && result.user) {
              currentUser = result.user;
              currentUser.name =
                currentUser.fullName || currentUser.username || "User";
              updateUserInfo(currentUser);
              console.log(
                "‚úÖ Authentication verified for:",
                currentUser.username
              );
              return true;
            } else {
              throw new Error("Invalid response format");
            }
          } else {
            const errorData = await response.json().catch(() => ({}));
            console.error("‚ùå Auth response error:", errorData);
            throw new Error(errorData.error || `HTTP ${response.status}`);
          }
        } catch (error) {
          console.error("‚ùå Auth verification failed:", error);
          localStorage.removeItem("authToken");
          localStorage.removeItem("user");
          authToken = null;
          showNotification("Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n", "error");
          setTimeout(() => {
            redirectToLogin();
          }, 1500);
          return false;
        } finally {
          hideLoading();
        }
      }

      function redirectToLogin() {
        console.log("üîÑ Redirecting to login page");
        window.location.href = "/login";
      }

      function updateUserInfo(user) {
        const userName = document.getElementById("userName");
        const userAvatar = document.getElementById("userAvatar");

        let displayName =
          user.fullName ||
          user.full_name ||
          user.name ||
          user.username ||
          "User";
        if (user.role === "admin" && !displayName) {
          displayName = "Admin";
        }

        console.log("üë§ Updating user info:", {
          displayName,
          role: user.role,
          username: user.username,
        });

        if (userName) {
          userName.textContent = displayName;
        }

        if (userAvatar) {
          userAvatar.textContent = displayName.charAt(0).toUpperCase();
          userAvatar.title = `${
            user.role === "admin" ? "Admin" : "User"
          }: ${displayName}`;
        }

        const profileUsername = document.getElementById("profileUsername");
        const profileUserRole = document.getElementById("profileUserRole");
        const profileEmail = document.getElementById("profileEmail");
        const profileFullName = document.getElementById("profileFullName");

        if (profileUsername) profileUsername.value = user.username || "";
        if (profileUserRole)
          profileUserRole.value = user.role === "admin" ? "Admin" : "User";
        if (profileEmail) profileEmail.value = user.email || "";
        if (profileFullName)
          profileFullName.value =
            user.fullName || user.full_name || user.name || "";
      }

      // ===================== CUSTOMERS DATA =====================
      async function loadCustomers() {
        try {
          showLoading("ƒêang t·∫£i kh√°ch h√†ng...");
          console.log("üìã Loading customers...");

          const response = await fetch("/api/customers", {
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
          });

          console.log("üìã Customers response status:", response.status);

          if (response.ok) {
            const result = await response.json();
            console.log("üìã Customers response:", result);

            if (result.success && Array.isArray(result.customers)) {
              customers = result.customers.map((customer) => ({
                ...customer,
                full_name: customer.full_name || customer.name || "Unknown",
                email: customer.email || "",
                phone: customer.phone || "",
                address: customer.address || "",
                profile_image:
                  customer.profile_image || customer.profile_pic || "",
              }));
              filteredCustomers = [...customers];
              displayCustomers(filteredCustomers);
              console.log(
                `‚úÖ Customers loaded successfully: ${customers.length} items`
              );
            } else {
              throw new Error(result.error || "Invalid response format");
            }
          } else {
            const errorData = await response.json().catch(() => ({}));
            console.error("‚ùå API error:", errorData);
            throw new Error(errorData.error || `HTTP ${response.status}`);
          }
        } catch (error) {
          console.error("‚ùå Load customers error:", error);
          customers = [];
          filteredCustomers = [];
          showNotification(
            `Kh√¥ng th·ªÉ t·∫£i danh s√°ch kh√°ch h√†ng: ${error.message}`,
            "error"
          );
          displayEmptyState();
        } finally {
          hideLoading();
        }
      }

      function displayCustomers(customersToShow) {
        const customersGrid = document.getElementById("customersGrid");

        if (!customersGrid) {
          console.error("‚ùå Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ customersGrid");
          return;
        }

        if (customersToShow.length === 0) {
          console.warn("‚ö†Ô∏è Kh√¥ng c√≥ kh√°ch h√†ng ƒë·ªÉ hi·ªÉn th·ªã");
          displayEmptyState();
          return;
        }

        customersGrid.innerHTML = customersToShow
          .map((customer) => createCustomerCard(customer))
          .join("");

        console.log(`‚úÖ Hi·ªÉn th·ªã ${customersToShow.length} kh√°ch h√†ng`);
      }

      function createCustomerCard(customer) {
        if (!customer.id) {
          console.error("‚ùå Customer missing ID:", customer);
          return "";
        }
        const customerImage =
          customer.profile_image ||
          customer.profile_pic ||
          "https://via.placeholder.com/300x200?text=No+Image";

        return `
    <div class="customer-card" data-id="${customer.id}">
      <div class="customer-image" style="background: none; padding: 0;">
        <img src="${customerImage}" 
             alt="${customer.full_name || "Customer"}" 
             style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px 12px 0 0;"
             onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div style="display: none; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea, #764ba2); align-items: center; justify-content: center; font-size: 48px; color: white;">
          <i class="fas fa-user"></i>
        </div>
      </div>
      <div class="customer-details">
        <h3 class="customer-name">${customer.full_name || "Unknown"}</h3>
        <p class="customer-email">${customer.email || "Ch∆∞a c√≥ email"}</p>
        <p class="customer-phone">${
          customer.phone || "Ch∆∞a c√≥ s·ªë ƒëi·ªán tho·∫°i"
        } </p>
        <div class="customer-actions">
          <button class="action-btn btn-edit" data-customer-id="${
            customer.id
          }" data-action="edit">
            <i class="fas fa-edit"></i>
            S·ª≠a
          </button>
          <button class="action-btn btn-delete" data-customer-id="${
            customer.id
          }" data-action="delete">
            <i class="fas fa-trash"></i>
            X√≥a
          </button>
        </div>
      </div>
    </div>
  `;
      }

      function displayEmptyState() {
        const customersGrid = document.getElementById("customersGrid");
        const searchTerm =
          document.getElementById("searchInput")?.value.trim() || "";

        let message = "Ch∆∞a c√≥ kh√°ch h√†ng trong danh s√°ch.";
        if (searchTerm) {
          message = `Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng n√†o kh·ªõp v·ªõi "${searchTerm}".`;
        }

        customersGrid.innerHTML = `
          <div class="empty-state" style="grid-column: 1 / -1;">
            <i class="fas fa-users"></i>
            <h3>Kh√¥ng c√≥ kh√°ch h√†ng n√†o</h3>
            <p>${message}</p>
          </div>
        `;
      }

      // ===================== SEARCH AND FILTER =====================
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      function setupFilters() {
        const searchInput = document.getElementById("searchInput");

        if (!searchInput) {
          console.warn("‚ö†Ô∏è Search input not found");
          return;
        }

        searchInput.setAttribute("autocomplete", "new-text");
        searchInput.setAttribute("type", "text");
        searchInput.setAttribute("name", `search_${Date.now()}`);

        searchInput.value = "";
        console.log("‚úÖ Search input cleared on load");

        searchInput.addEventListener("focus", () => {
          if (searchInput.value.includes("@")) {
            console.warn(
              "‚ö†Ô∏è Detected email in searchInput:",
              searchInput.value
            );
            searchInput.value = "";
          }
        });

        searchInput.addEventListener("input", () => {
          if (searchInput.value.includes("@")) {
            console.warn(
              "‚ö†Ô∏è Detected email in searchInput:",
              searchInput.value
            );
            searchInput.value = "";
          }
        });

        const debouncedApplyFilters = debounce(applyFilters, 300);
        searchInput.addEventListener("input", debouncedApplyFilters);

        console.log("‚úÖ Filters setup with enhanced autofill prevention");
      }

      function applyFilters() {
        const searchInput = document.getElementById("searchInput");

        if (!searchInput || !customers || customers.length === 0) {
          console.warn("‚ö†Ô∏è B·ªô l·ªçc ho·∫∑c danh s√°ch kh√°ch h√†ng kh√¥ng h·ª£p l·ªá");
          displayCustomers(customers || []);
          showNotification("Kh√¥ng c√≥ kh√°ch h√†ng ƒë·ªÉ l·ªçc", "warning");
          return;
        }

        const searchTerm = searchInput.value.toLowerCase().trim();

        console.log("üîç √Åp d·ª•ng b·ªô l·ªçc:", { searchTerm });

        if (!searchTerm) {
          filteredCustomers = [...customers];
          displayCustomers(filteredCustomers);
          console.log("üîç Kh√¥ng c√≥ b·ªô l·ªçc, hi·ªÉn th·ªã t·∫•t c·∫£ kh√°ch h√†ng");
          return;
        }

        filteredCustomers = customers.filter((customer) => {
          if (!customer || !customer.name) {
            console.warn("‚ö†Ô∏è Kh√°ch h√†ng kh√¥ng h·ª£p l·ªá:", customer);
            return false;
          }

          const matchesSearch =
            customer.name.toLowerCase().includes(searchTerm) ||
            (customer.email &&
              customer.email.toLowerCase().includes(searchTerm));

          return matchesSearch;
        });

        console.log(`üîç ƒê√£ l·ªçc ƒë∆∞·ª£c ${filteredCustomers.length} kh√°ch h√†ng`);

        if (filteredCustomers.length === 0 && searchTerm) {
          showNotification(
            `Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng n√†o kh·ªõp v·ªõi "${searchTerm}"`,
            "info"
          );
        }

        displayCustomers(filteredCustomers);
      }

      // ===================== CUSTOMER ACTIONS =====================
      function addCustomer() {
        editingCustomerId = null;
        document.getElementById("modalTitle").textContent =
          "Th√™m kh√°ch h√†ng m·ªõi";
        document.getElementById("modalIcon").className = "fas fa-user-plus";
        document.getElementById("saveButtonText").textContent =
          "Th√™m kh√°ch h√†ng";

        document.getElementById("customerForm").reset();
        document.getElementById("customerModal").classList.add("show");
      }

      function editCustomer(id) {
        const customer = customers.find((c) => c.id === id);
        if (!customer) {
          showNotification("Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng", "error");
          return;
        }
        editingCustomerId = id;
        console.log("üñ±Ô∏è H√†nh ƒë·ªông edit cho kh√°ch h√†ng ID:", editingCustomerId);
        document.getElementById("modalTitle").textContent = "S·ª≠a kh√°ch h√†ng";
        document.getElementById("modalIcon").className = "fas fa-user-edit";
        document.getElementById("saveButtonText").textContent = "L∆∞u thay ƒë·ªïi";
        document.getElementById("customerFullName").value =
          customer.full_name || customer.name || "";
        document.getElementById("customerEmail").value = customer.email || "";
        document.getElementById("customerPhone").value = customer.phone || "";
        document.getElementById("customerAddress").value =
          customer.address || "";
        document.getElementById("customerProfilePic").value =
          customer.profile_image || customer.profile_pic || "";
        document.getElementById("customerModal").classList.add("show");
      }

      function deleteCustomer(id) {
        const customer = customers.find((c) => c.id === id);
        if (!customer) {
          showNotification("Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng", "error");
          return;
        }
        customerToDelete = { ...customer, id };
        document.getElementById("deleteCustomerName").textContent =
          customer.full_name || customer.name || "Unknown";
        document.getElementById("deleteModal").classList.add("show");
      }

      // ===================== MODAL FUNCTIONS =====================
      function closeCustomerModal() {
        document.getElementById("customerModal").classList.remove("show");
        document.getElementById("customerForm").reset();
        editingCustomerId = null;
      }

      function closeDeleteModal() {
        document.getElementById("deleteModal").classList.remove("show");
        customerToDelete = null;
      }

      async function saveCustomer(event) {
        event.preventDefault();
        const saveButton = document.getElementById("saveCustomerBtn");
        if (saveButton.disabled) {
          console.log("üîÑ Y√™u c·∫ßu l∆∞u ƒëang x·ª≠ l√Ω, b·ªè qua...");
          return;
        }
        saveButton.disabled = true;

        const full_name = document
          .getElementById("customerFullName")
          .value.trim();
        const email = document.getElementById("customerEmail").value.trim();
        const phone = document.getElementById("customerPhone").value.trim();
        const address = document.getElementById("customerAddress").value.trim();
        const profile_pic = document
          .getElementById("customerProfilePic")
          .value.trim();

        if (!full_name) {
          showNotification("Vui l√≤ng ƒëi·ªÅn h·ªç v√† t√™n", "error");
          saveButton.disabled = false;
          return;
        }

        if (!email) {
          showNotification("Vui l√≤ng ƒëi·ªÅn email", "error");
          saveButton.disabled = false;
          return;
        }

        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          showNotification("Email kh√¥ng h·ª£p l·ªá", "error");
          saveButton.disabled = false;
          return;
        }

        if (phone && !/^\d{10,11}$/.test(phone)) {
          showNotification("S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá", "error");
          saveButton.disabled = false;
          return;
        }

        const customerData = {
          full_name,
          email,
          phone: phone || null,
          address: address || null,
          profile_pic: profile_pic || null,
        };

        try {
          showLoading(
            editingCustomerId ? "ƒêang c·∫≠p nh·∫≠t..." : "ƒêang th√™m kh√°ch h√†ng..."
          );
          console.log(
            "üíæ Sending customer update:",
            JSON.stringify(customerData, null, 2)
          );

          if (!authToken) {
            throw new Error(
              "Kh√¥ng t√¨m th·∫•y token ƒëƒÉng nh·∫≠p. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i."
            );
          }

          const url = editingCustomerId
            ? `/api/customers/${editingCustomerId}`
            : "/api/customers";
          console.log(`üì° Sending to URL: ${url}`);

          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 10000); // Timeout 10s

          const response = await fetch(url, {
            method: editingCustomerId ? "PUT" : "POST",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json; charset=utf-8",
            },
            body: JSON.stringify(customerData),
            signal: controller.signal,
          });

          clearTimeout(timeoutId);

          const result = await response.json();
          if (response.ok && result.success) {
            showNotification(
              editingCustomerId
                ? "C·∫≠p nh·∫≠t kh√°ch h√†ng th√†nh c√¥ng!"
                : "Th√™m kh√°ch h√†ng th√†nh c√¥ng!",
              "success"
            );
            closeCustomerModal();
            await loadCustomers();
            filteredCustomers = [...customers];
            displayCustomers(filteredCustomers);
          } else {
            throw new Error(result.error || `HTTP ${response.status}`);
          }
        } catch (error) {
          console.error("‚ùå Save customer error:", error.message);
          showNotification(`L·ªói khi l∆∞u kh√°ch h√†ng: ${error.message}`, "error");
          if (error.name === "AbortError") {
            showNotification(
              "Y√™u c·∫ßu h·∫øt th·ªùi gian, vui l√≤ng th·ª≠ l·∫°i",
              "error"
            );
          } else if (
            error.message.includes("token") ||
            error.message.includes("403")
          ) {
            window.location.href = "/login?error=session_expired";
          }
        } finally {
          hideLoading();
          saveButton.disabled = false;
        }
      }
      async function confirmDelete() {
        if (!customerToDelete) return;

        const confirmButton = document.getElementById("confirmDeleteBtn");
        confirmButton.disabled = true;

        try {
          showLoading("ƒêang x√≥a kh√°ch h√†ng...");
          console.log("üóëÔ∏è Deleting customer:", customerToDelete.id);

          const response = await fetch(
            `/api/customers/${customerToDelete.id}`,
            {
              method: "DELETE",
              headers: {
                Authorization: `Bearer ${authToken}`,
                "Content-Type": "application/json",
              },
            }
          );

          console.log("üóëÔ∏è Delete response:", {
            status: response.status,
            statusText: response.statusText,
          });

          const result = await response.json();
          console.log("üóëÔ∏è Delete result:", result);

          if (response.ok && result.success) {
            showNotification("X√≥a kh√°ch h√†ng th√†nh c√¥ng!", "success");
            closeDeleteModal();
            await loadCustomers();
            filteredCustomers = [...customers];
            displayCustomers(filteredCustomers);
          } else {
            throw new Error(result.error || `HTTP ${response.status}`);
          }
        } catch (error) {
          console.error("‚ùå Delete customer error:", error);
          showNotification(
            `Kh√¥ng th·ªÉ x√≥a kh√°ch h√†ng: ${error.message}`,
            "error"
          );
        } finally {
          hideLoading();
          confirmButton.disabled = false;
        }
      }

      // ===================== PROFILE FUNCTIONS =====================
      function viewProfile() {
        document.getElementById("dropdownMenu").classList.remove("show");
        document.getElementById("profileModal").classList.add("show");
      }

      function closeProfileModal() {
        document.getElementById("profileModal").classList.remove("show");
        document.getElementById("profileOldPassword").value = "";
        document.getElementById("profileNewPassword").value = "";
        document.getElementById("profileConfirmPassword").value = "";
        document.getElementById("profileShowPassword").checked = false;
      }

      async function saveProfile() {
        const oldPassword = document
          .getElementById("profileOldPassword")
          .value.trim();
        const newPassword = document
          .getElementById("profileNewPassword")
          .value.trim();
        const confirmPassword = document
          .getElementById("profileConfirmPassword")
          .value.trim();
        const fullName = document
          .getElementById("profileFullName")
          .value.trim();

        if (!fullName) {
          showNotification("Vui l√≤ng ƒëi·ªÅn h·ªç v√† t√™n", "warning");
          return;
        }

        if (
          (newPassword || confirmPassword) &&
          (!oldPassword || !newPassword || !confirmPassword)
        ) {
          showNotification(
            "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin m·∫≠t kh·∫©u",
            "warning"
          );
          return;
        }

        if (newPassword && newPassword !== confirmPassword) {
          showNotification("M·∫≠t kh·∫©u m·ªõi kh√¥ng kh·ªõp", "error");
          return;
        }

        if (newPassword && newPassword.length < 6) {
          showNotification("M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±", "error");
          return;
        }

        try {
          showLoading("ƒêang c·∫≠p nh·∫≠t th√¥ng tin...");

          const endpoint =
            currentUser.role === "admin"
              ? "/api/admin/update"
              : "/api/auth/update-profile";
          const updateData =
            currentUser.role === "admin"
              ? {
                  full_name: fullName,
                  old_password: oldPassword || undefined,
                  new_password: newPassword || undefined,
                }
              : {
                  fullName,
                  oldPassword: oldPassword || undefined,
                  newPassword: newPassword || undefined,
                };

          console.log("üì§ Updating profile via:", endpoint, updateData);

          const response = await fetch(endpoint, {
            method: currentUser.role === "admin" ? "POST" : "PUT",
            headers: {
              Authorization: `Bearer ${authToken}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updateData),
          });

          const result = await response.json();

          if (response.ok && result.success) {
            showNotification("C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!", "success");
            currentUser = { ...currentUser, ...result.user };
            updateUserInfo(currentUser);
            closeProfileModal();
          } else {
            throw new Error(result.error || `HTTP ${response.status}`);
          }
        } catch (error) {
          console.error("‚ùå Profile update error:", error);
          showNotification(
            error.message || "L·ªói khi c·∫≠p nh·∫≠t th√¥ng tin",
            "error"
          );
        } finally {
          hideLoading();
        }
      }

      function updateNavigationForAdmin() {
        if (currentUser && currentUser.role === "admin") {
          console.log("üîß Updating navigation for admin user");
          const navItems = document.querySelectorAll(".nav-item");
          navItems.forEach((item) => {
            const href = item.getAttribute("href");
            const page = item.getAttribute("data-page");
            if (href && !href.startsWith("/admin") && href !== "#") {
              switch (page) {
                case "dashboard":
                  item.setAttribute("href", "/admin/dashboard");
                  break;
                case "products":
                  item.setAttribute("href", "/products-page");
                  break;
                case "customers":
                  item.setAttribute("href", "/customers-page");
                  break;
                case "orders":
                  item.setAttribute("href", "/orders-page");
                  break;
                case "statistics":
                  item.setAttribute("href", "/statistics-page");
                  break;
              }
            }
          });
        }
      }

      // ===================== LOGOUT FUNCTIONALITY =====================
      async function logout() {
        console.log("üö™ Logout function called");
        document.getElementById("dropdownMenu").classList.remove("show");

        try {
          showLoading("ƒêang ƒëƒÉng xu·∫•t...");
          localStorage.removeItem("authToken");
          localStorage.removeItem("user");
          authToken = null;
          currentUser = null;
          console.log("üßπ Local data cleared");
          hideLoading();
          window.location.href = "/login";
        } catch (error) {
          console.error("‚ùå Logout error:", error);
          hideLoading();
          window.location.href = "/login";
        }
      }

      // ===================== UTILITY FUNCTIONS =====================
      function showLoading(message = "ƒêang t·∫£i...") {
        const overlay = document.getElementById("loadingOverlay");
        const text = overlay.querySelector(".loading-text");
        if (text) text.textContent = message;
        overlay.classList.add("show");
      }

      function hideLoading() {
        const overlay = document.getElementById("loadingOverlay");
        overlay.classList.remove("show");
      }

      function showNotification(message, type = "success", duration = 4000) {
        const existingNotifications =
          document.querySelectorAll(".notification");
        existingNotifications.forEach((notification) => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        });

        const sanitizedMessage = message.replace(/<[^>]+>/g, "");
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        const icons = {
          success: "check-circle",
          error: "exclamation-triangle",
          info: "info-circle",
          warning: "exclamation-triangle",
        };

        notification.innerHTML = `
          <i class="fas fa-${icons[type] || icons.info}"></i>
          ${sanitizedMessage}
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
          if (notification.parentNode) {
            notification.style.animation = "slideOutRight 0.4s ease forwards";
            setTimeout(() => {
              if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
              }
            }, 400);
          }
        }, duration);
      }

      // ===================== EVENT LISTENERS =====================
      document.addEventListener("DOMContentLoaded", function () {
        console.log("üîß Setting up event listeners...");

        const settingsBtn = document.getElementById("settingsBtn");
        const dropdownMenu = document.getElementById("dropdownMenu");

        if (settingsBtn && dropdownMenu) {
          settingsBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            dropdownMenu.classList.toggle("show");
          });
        }

        document.addEventListener("click", (e) => {
          if (settingsBtn && dropdownMenu) {
            if (
              !settingsBtn.contains(e.target) &&
              !dropdownMenu.contains(e.target)
            ) {
              dropdownMenu.classList.remove("show");
            }
          }
        });

        const profileBtn = document.getElementById("profileBtn");
        const logoutBtn = document.getElementById("logoutBtn");

        if (profileBtn) {
          profileBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log("üë§ Profile button clicked");
            viewProfile();
          });
        }

        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            console.log("üö™ Logout button clicked");
            logout();
          });
        }

        const profileModal = document.getElementById("profileModal");
        const closeProfileModalBtn = document.getElementById(
          "closeProfileModalBtn"
        );
        const profileCancelBtn = document.getElementById("profileCancelBtn");
        const profileSaveBtn = document.getElementById("profileSaveBtn");
        const profileShowPassword = document.getElementById(
          "profileShowPassword"
        );

        if (closeProfileModalBtn) {
          closeProfileModalBtn.addEventListener("click", closeProfileModal);
        }

        if (profileCancelBtn) {
          profileCancelBtn.addEventListener("click", closeProfileModal);
        }

        if (profileSaveBtn) {
          profileSaveBtn.addEventListener("click", saveProfile);
        }

        if (profileShowPassword) {
          profileShowPassword.addEventListener("change", function () {
            const type = this.checked ? "text" : "password";
            document.getElementById("profileOldPassword").type = type;
            document.getElementById("profileNewPassword").type = type;
            document.getElementById("profileConfirmPassword").type = type;
          });
        }

        if (profileModal) {
          profileModal.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal-overlay")) {
              closeProfileModal();
            }
          });
        }

        const addCustomerBtn = document.getElementById("addCustomerBtn");
        if (addCustomerBtn) {
          addCustomerBtn.addEventListener("click", addCustomer);
        }

        const customerModal = document.getElementById("customerModal");
        const closeCustomerModalBtn =
          document.getElementById("closeCustomerModal");
        const cancelCustomerBtn = document.getElementById("cancelCustomerBtn");
        const customerForm = document.getElementById("customerForm");

        if (closeCustomerModalBtn) {
          closeCustomerModalBtn.addEventListener("click", closeCustomerModal);
        }

        if (cancelCustomerBtn) {
          cancelCustomerBtn.addEventListener("click", closeCustomerModal);
        }

        if (customerForm) {
          customerForm.addEventListener("submit", saveCustomer);
        }

        if (customerModal) {
          customerModal.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal-overlay")) {
              closeCustomerModal();
            }
          });
        }

        const deleteModal = document.getElementById("deleteModal");
        const closeDeleteModalBtn = document.getElementById("closeDeleteModal");
        const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
        const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

        if (closeDeleteModalBtn) {
          closeDeleteModalBtn.addEventListener("click", closeDeleteModal);
        }

        if (cancelDeleteBtn) {
          cancelDeleteBtn.addEventListener("click", closeDeleteModal);
        }

        if (confirmDeleteBtn) {
          confirmDeleteBtn.addEventListener("click", confirmDelete);
        }

        if (deleteModal) {
          deleteModal.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal-overlay")) {
              closeDeleteModal();
            }
          });
        }

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") {
            closeCustomerModal();
            closeDeleteModal();
            closeProfileModal();
          }
        });

        setupFilters();
        setupCustomerActions();

        console.log("‚úÖ Event listeners setup complete");
      });

      // ===================== CUSTOMER ACTIONS EVENT DELEGATION =====================
      function setupCustomerActions() {
        const customersGrid = document.getElementById("customersGrid");

        if (customersGrid) {
          customersGrid.addEventListener("click", function (e) {
            const customerCard = e.target.closest(".customer-card");
            const actionButton = e.target.closest("button[data-action]");

            if (customerCard) {
              e.stopPropagation();
              console.log("üñ±Ô∏è Click tr√™n customer-card, ngƒÉn lan truy·ªÅn");
            }

            if (!actionButton) {
              console.log("üñ±Ô∏è Click ngo√†i n√∫t edit/delete, b·ªè qua:", e.target);
              return;
            }

            e.preventDefault();

            const customerId = actionButton.getAttribute("data-customer-id");
            const action = actionButton.getAttribute("data-action");

            console.log(
              `üñ±Ô∏è H√†nh ƒë·ªông ${action} cho kh√°ch h√†ng ID: ${customerId}`
            );

            if (!customerId) {
              console.error(
                "‚ùå ID kh√°ch h√†ng kh√¥ng h·ª£p l·ªá:",
                actionButton.getAttribute("data-customer-id")
              );
              showNotification("ID kh√°ch h√†ng kh√¥ng h·ª£p l·ªá", "error");
              return;
            }

            if (action === "edit") {
              editCustomer(customerId);
            } else if (action === "delete") {
              deleteCustomer(customerId);
            }
          });

          console.log("‚úÖ ƒê√£ thi·∫øt l·∫≠p x·ª≠ l√Ω h√†nh ƒë·ªông kh√°ch h√†ng");
        }
      }

      // ===================== NAVIGATION =====================
      document.querySelectorAll(".nav-item").forEach((item) => {
        item.addEventListener("click", (e) => {
          e.preventDefault();
          const href = item.getAttribute("href");
          const page = item.getAttribute("data-page");
          document
            .querySelectorAll(".nav-item")
            .forEach((nav) => nav.classList.remove("active"));
          item.classList.add("active");
          console.log(`üîó Navigating to: ${href}`);
          window.location.href = href;
        });
      });
      // ===================== INITIALIZATION =====================
      async function initApp() {
        console.log("üöÄ Initializing Customers Page...");
        try {
          const isAuthenticated = await checkAuth();
          if (isAuthenticated) {
            console.log("‚úÖ Authentication successful");
            updateNavigationForAdmin();
            const searchInput = document.getElementById("searchInput");
            if (searchInput) {
              searchInput.value = "";
              console.log("‚úÖ Cleared search input default value");
            }
            await loadCustomers();
            filteredCustomers = [...customers];
            displayCustomers(filteredCustomers);
            console.log("‚úÖ Customers page initialized successfully!");
          } else {
            console.log("‚ùå Authentication failed - redirecting to login");
          }
        } catch (error) {
          console.error("‚ùå App initialization error:", error);
          showNotification("L·ªói kh·ªüi t·∫°o ·ª©ng d·ª•ng", "error");
          setTimeout(() => redirectToLogin(), 2000);
        }
      }

      document.addEventListener("DOMContentLoaded", initApp);

      console.log("‚úÖ Customers Page Script Loaded");

      // ===================== DEBUG FUNCTIONS =====================
      window.testEditCustomer = function (id = 1) {
        console.log("üß™ Testing edit customer with ID:", id);
        editCustomer(id);
      };

      window.testDeleteCustomer = function (id = 1) {
        console.log("üß™ Testing delete customer with ID:", id);
        deleteCustomer(id);
      };

      window.testAddCustomer = function () {
        console.log("üß™ Testing add customer");
        addCustomer();
      };

      console.log("üîß Debug functions available:");
      console.log("- testEditCustomer(id) - Test edit customer");
      console.log("- testDeleteCustomer(id) - Test delete customer");
      console.log("- testAddCustomer() - Test add customer");
    </script>
  </body>
</html>
